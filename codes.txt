# ..... <- read.csv2("...")
#str(...)
#attach(...)
# n dimenzija uzorka , x frekvencija uspjeha

#tockovna procjena:
xn <- x/n #relativna frekvencija

#procjena proporcije 95%-tnim pouzdanim intervalom:
alfa <- 0.05
zalfa <- qnorm(1-alfa/2)
dg <- xn - zalfa*sqrt((xn*(1-xn))/n)
gg <- xn + zalfa*sqrt((xn*(1-xn))/n)
c(dg, gg)

#ili
prop.test(x,n)$conf.int



####

# npr: p - proporcija klijenata koji imaju odobren pocek na kredit veca od 50% ?
#  H0: p <= 0.5 
#  H1: p > 0.5
#Binomni test - uvijek ga mozemo koristiti neovisno o velicini uzorka n
binom.test(x, n, p = 0.5, alternative = "greater")

#kriticno podrucje:
( qalfa <- qbinom(0.95, n, 0.5) )
c(qalfa, Inf) #kriticno podrucje, naš x (frekvencija uspjeha) treba biti u intervalu

#asimptotski z-test :  moramo imati velik broj podataka u uzorku
z <- ( x/n - 0.5 ) / (sqrt( 0.5*(1-0.5) ) )*sqrt(n) #realizacija test statistike
1-pnorm(z) #p-vrijednost


#####
#theta - vjerojatnost pisma (bacamo novcic n puta)
#Hipoteze:
#  H0: theta = 1/2
#  H1: theta != 1/2
binom.test(x, n, p = 0.5, alternative = "two.sided")


####
# theta - nepoznata proporcija ljudi s negativnim rezultatom na CLOtest
#Hipoteze:
#  H0: theta = 0.2 
#  H1: theta < 0.2
hormon <- read.csv2("hormon.csv")
str(hormon)
clo <- hormon$CLOtest
table(clo) #12 ih je negativno
length(clo) #82 ukupno testirano
binom.test(12, 82, p = 0.2, alternative = "less")

####
#  ** procjena OCEKIVANJA pouzdanim intervalima **

#naci pouzdani interval za nepoznato ocekivanje EX, za norm.distr. 
# cija je stand.devij. = 27 , uz pouzdanosti gama = 1-alfa = 0.95
# buduci da je varijanca poznata koristimo Z interval !!!
alfa <- 0.05 
(zalfa <- qnorm(1-alfa/2))
c( 102 - zalfa*sqrt(27)/sqrt(200), 102 + zalfa*sqrt(27)/sqrt(200) )
# 102 je bila zadana aritm.sredina mean()


##### 
set.seed(1)
n <- 1000      # generiramo uzorak iz N(25,2)
x <- rnorm(n, 25, sqrt(2))
alfa <- 0.05
talfa <- qt(1-alfa/2, n-1)   # t - studentova dist. jer je Var nepoznata!!
dg <- mean(x) - talfa*sd(x)/sqrt(n)  # sd() nam je procjena za st.dev.
gg <- mean(x) + talfa*sd(x)/sqrt(n)
c(dg, gg)
gg - dg

#t-interval moguce je dobiti i u okviru rezultata funkcije t.test
t.test(x)  # ili t.test(x)$conf.int
t.test(x, conf.level = 0.99)  # po defaultu je 0.95 


#####
plot(density( ), col="red")  # procjena funkcija gustoce
curve(dnorm(x, mean( ),sd( )), col="blue", add=T)  # parametri: prosjek i stand.dev.


######
#  Testovi o ocekivanju                     

# H0: mu=0
# H1: mu!=0

# 1. NACIN
#Izracunajmo vrijednost test-statistike
teststat <- (mean(x) - 0) / ( korijen varijance / sqrt(n)) #ova nula je iz hipoteza
#Odredimo z_{alfa/2}, alfa=0.05
alfa <- 0.05
zalfapola <- qnorm(1 - alfa / 2)
teststat
#Kriticno podrucje
c(-Inf, -zalfapola, zalfapola, Inf)     

# 2. NACIN  - samo ako je dostupan cijeli niz podataka
install.packages("BSDA")  
z.test(x, mu = 0, sigma.x = 1)

####
uzorak <- rep(gol$brgol, gol$frek)     #ponovi svaki broj golova onoliko puta kolika mu je frekvencija
t.test(uzorak, mu = 2.5)


########
#  TESTIRANJE HIPOTEZA O DISKRETNOJ DISTRIBUCIJI - CHI^2 TEST 
# kada provjeravamo dolaze li podaci iz neke odredene DISKRETNE distibucije
chisq.test(x, vjer)
#x je vektor opaženih frekvencija, a p je vektor vjerojatnosti pretpostavljene (teorijske) distribucije

# B(n, p) distribucija cije vjerojatnosti su:
dbinom(0:n, n, p)

#  TESTIRANJE HIPOTEZA O NEPREKIDNOJ DISTRIBUCIJI - KS TEST 
ks.test(podaci, "tip_distr", parametri)
#tip distibucije i parametri npr= "punif" a,b ; "pexp", lam ; "pnorm" , EX, ST.DEV.


# TESTIRANJE HIPOTEZA O NORMALNOSTI - SW TEST  
# kada su parametri nepoznati; test samo kaže je li norm. distr. ili ne
shapiro.test(x)  # može i kada imamo mali uzorak
#Ho - da ima normalnu
#graficka usporedba
qqnorm(x)
qqline(x)


########
#Statisticko zakljucivanje temeljno na dva uzorka:
#Nezavisni uzorci - razlike u proporcijama, ocekivanju i varijanci

# Test o proporciji za dva nezavisna slucajna uzorka 
prop.test(c(f1, f2), c(n1, n2), alternative = "..")

prop.test(c(f1, f2), c(n1, n2), alternative = "..", correct = F)
#ova p-vrijednost odgovara p-vrijednosti dobivenoj z-testom.


#Testovi o ocekivanju i varijanci

t.test(EX1, EX2, alternative = "..", var.equal = F)
#Default vrijednost za var.equal je FALSE, odnosno po defaultu se provodi Welchov t-test


# usporedivanje varijavilnosti = usporedivanje varijanci  -> F test

sigma1hat2 <- var(x1)  #procjene varijanci
sigma2hat2 <- var(x2)
# vrijednost test-statistike
(vhat <- sigma1hat2/sigma2hat2)
alfa <- 0.05
f <- qf(alfa, length(x1) - 1, length(x2) - 1)
# kriticno podrucje
c(-Inf, f) 

#Korištenje R funkcije var.test()
var.test(EX1, EX2, alternative = "..") # samo kada imamo veliki uzorak
                                       # ili pretp. o normalnosti


#Nezavisni uzorci - razlike u distribucijama
#   Test o lokacijskom pomaku  (MWW test) - alternativa t-testu 
# trazi lokalni pomak, tj pretpostavlja da su distribucije slicne
wilcox.test(x, y, alternative="..")

# KS test za dva nezavisna slucajna uzorka
# pokazuje postoji li generalna razlika u distribucijama, H0: F1==F2
# koristimo kada u zad ne pise koja se distr traži/želi...
ks.test(x, y)   #default vrijednost za alternative je "two.sided"

#Empirijske funkcije distribucije možemo usporediti graficki:
plot(ecdf(x), col = "blue")
plot(ecdf(y), add = TRUE, col = "red")


#Chi-kvadrat test o jednakosti distribucija (o homogenosti)  DISKRETNE!!
metode <- matrix(c(14, 26, 34, 16, 10, 18, 36, 58, 56, 32), 2, 5, byrow = TRUE)
colnames(metode) <- c("1", "2", "3", "4", "5")
rownames(metode) <- c("1", "2")
chisq.test(metode)

#Statisticko zakljucivanje temeljno na dva uzorka:
#Vezani uzorci - razlike u proporcijama, ocekivanju i lokacijski pomak


#   Test o proporciji za vezane slucajne uzorke
# Hipoteze: H0: \bar{theta} = 0.5
#           H1: \bar{theta} < 0.5
#Retci 12 godina i stupci 14 godina:
tab <- matrix(c(37, 15, 10, 8), 2, 2, byrow = T)
rownames(tab) <- c(0, 1)
colnames(tab) <- c(0, 1)
tab
#Broj pozitivnih razlika (parova (1,0)): 10
#Broj ne-nul razlika (parova (1,0) i (0,1)): 10+15=25  - SPOREDNA DIJAGONALA
binom.test(10, 25, p = 0.5, alternative = "less")


#  Testovi o ocekivanju za vezane slucajne uzorke 
t.test(X, Y, alternative = "..", paired = TRUE)

# Test o lokacijskom pomaku za vezane slucajne uzorke 
wilcox.test(x,y,paired=T,alternative="..") 


#Vezani uzorci - veze medu varijablama

# Chi-kvadrat test o nezavisnosti
chisq.test(table(X, Y))



#   Mjere asocijacije i korelacije   

cor(x, y) # blizu 0 - nezavisni, blizu 1- postoji poz.korelacija 
cor(x, y, method = "spearman")  #(ne)postojanje monotone veze medu var.

cor.test(log(x), log(y), alternative = "..")  #ponekad lakše uociti na log-skali
cor.test(x, y, method = "spearman", alternative = "..")


